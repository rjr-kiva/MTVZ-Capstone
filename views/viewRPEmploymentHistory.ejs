<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
        <title>Profile Page</title>

        <link rel="shortcut icon" href="/assets/img/ECTAG.png">

        <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

        <link rel="stylesheet" href="/assets/plugins/fontawesome/css/fontawesome.min.css">
        <link rel="stylesheet" href="/assets/plugins/fontawesome/css/all.min.css">

        <link rel="stylesheet" href="/assets/plugins/select2/css/select2.min.css">

        <link rel="stylesheet" href="/assets/css/style.css">
        <!--[if lt IE 9]>
			<script src="/assets/js/html5shiv.min.js"></script>
			<script src="/assets/js/respond.min.js"></script>
		<![endif]-->
    </head>

    <body>

        <div class="main-wrapper">

            <div class="header">

                <div class="header-left">
                    <a href="/home" class="logo">
                        <img src="/assets/img/ectag-header.jpg" alt="Logo">
                    </a>
                    <a href="/home" class="logo logo-small">
                        <img src="/assets/img/ectag-icon.jpg" alt="Logo" width="30" height="30">
                    </a>
                    <a href="javascript:void(0);" id="toggle_btn">
                        <span class="bar-icon">
                            <span></span>
                            <span></span>
                            <span></span>
                        </span>
                    </a>
                </div>

                <a class="mobile_btn" id="mobile_btn">
                    <i class="fas fa-bars"></i>
                </a>


                <ul class="nav user-menu">


                    <li class="nav-item dropdown has-arrow main-drop">
                        <p class="dropdown-toggle nav-link" data-toggle="dropdown">
                            <span class="user-img">
                                <% if (userData.gender=="Male" ) { %>
                                    <img src="/assets/img/profiles/hrMale.png" alt="">
                                    <% } else if (userData.gender=="Female" ) { %>
                                        <img src="/assets/img/profiles/hrFemale.png" alt="">
                                        <% } %>
                                            <span class="status online"></span>
                            </span>
                            <b><span>
                                    <%= userData.name %>
                                </span></b>
                        </p>
                    </li>

                </ul>
                <div class="dropdown mobile-user-menu show">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i
                            class="fa fa-ellipsis-v"></i></a>
                    <div class="dropdown-menu dropdown-menu-right ">
                        <a class="dropdown-item" href="profile.html">My Profile</a>
                        <a class="dropdown-item" href="settings.html">Settings</a>
                        <a class="dropdown-item" href="login.html">Logout</a>
                    </div>
                </div>

            </div>


            <div class="sidebar" id="sidebar">
                <div class="sidebar-inner slimscroll">
                    <div class="sidebar-contents">
                        <div id="sidebar-menu" class="sidebar-menu">
                            <div class="mobile-show">
                                <div class="offcanvas-menu">
                                    <div class="user-info align-center bg-theme text-center">
                                        <span class="lnr lnr-cross  text-white" id="mobile_btn_close">X</span>
                                        <a href="javascript:void(0)" class="d-block menu-style text-white">
                                            <div class="user-avatar d-inline-block mr-3">
                                                <img src="/assets/img/profiles/avatar-18.jpg" alt="user avatar"
                                                    class="rounded-circle" width="50">
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                <div class="sidebar-input">
                                    <div class="top-nav-search">
                                        <form>
                                            <input type="text" class="form-control" placeholder="Search here">
                                            <button class="btn" type="submit"><i class="fas fa-search"></i></button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <ul>
                                <li>
                                    <a href="/home"><img src="/assets/img/home.svg" alt="sidebar_img">
                                        <span>Dashboard</span></a>
                                </li>
                                <li>
                                        <a href="/applicants"><img src="/assets/img/employee.svg"
                                                alt="sidebar_img"><span>
                                                Applicants</span></a>
                                </li>
                                <% if(userData.role=="Admin" || userData.role == "HR Head" ) {%>
                                    <li>
                                        <a href="/company"><img src="/assets/img/company.svg"
                                                alt="sidebar_img"><span>Company</span></a>
                                    </li>
                                    <% } %>
                                    <% if(userData.role=="Admin") {%>
                                    <li>
                                            <a href="/ectag-employee"><img src="/assets/img/employee.svg"
                                                    alt="sidebar_img"><span>
                                                    ECTAG Employee</span></a>
                                    </li>
                                    <% } %>

                                        <li class="active">
                                                <a href="/records"><img src="/assets/img/report.svg"
                                                        alt="sidebar_img"><span>Records</span></a>
                                        </li>
                            </ul>
                            <ul class="logout">
                                <li>
                                    <a href="/logout"><img src="/assets/img/logout.svg" alt="sidebar_img"><span>Log
                                            out</span></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>


            <div class="page-wrapper">
                <div class="content container-fluid">
                    <div class="row">
                        <div class="col-xl-12 col-sm-12 col-12 ">
                            <div class="row">
                                <div class="col-xl-12 col-sm-12 col-12">
                                    <div class="breadcrumb-path mb-4">
                                        <ul class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="/home"><img src="/assets/img/dash.png"
                                                        class="mr-2" alt="breadcrumb">Home</a>
                                            </li>
                                            <li class="breadcrumb-item active">
                                                Records
                                            </li>
                                        </ul>
                                        <h3>
                                            Employee Profile
                                        </h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <% if (userData.role == "HR Assistant") {%>

                        <div class="col-xl-12 col-sm-12 col-12 mb-4">
                            <div class="row">
                                <div class="col-xl-12 col-sm-12 col-12 ">
                                    <label class="employee_count"><%= profileData.companyName.length %> Employment History Record</label>
                                </div>
                            </div>
                        </div>

                        <%} else {%>

                        <div class="col-xl-12 col-sm-12 col-12 mb-4">
                            <div class="row">
                                <div class="col-xl-10 col-sm-8 col-12 ">
                                    <label class="employee_count"><%= profileData.lastName %>, <%= profileData.firstName %> <%= profileData.middleName %> : <%= profileData.companyName.length %> Employment Record</label>
                                </div>
                                <div class="head-link-set col-xl-2 col-sm-8 col-12 ">
                                    <button type="button" class="btn btn-add" onclick="window.location='/add-employment-history/<%= profileData.id %>'" <% if(profileData.currentlyDeployed == "true") { %> disabled <% } %> ><% if(profileData.currentlyDeployed == "true") { %> Employee Currently Deployed <% } else { %> <i data-feather="plus"></i>Add Employment History <% } %> </button>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-12 col-sm-12 col-12 mb-4">
                            <div class="row">
                                <div class="col-xl-12 col-sm-8 col-12 ">
                                    <% var avg = 0;
                                    profileData.companyRatings.forEach((dataInfo)=>{
                                        avg = avg + parseInt(dataInfo);
                                    }) 
                                    avg = avg / profileData.companyRatings.length 
                                    
                                    if(avg <= 20){
                                        var string = "Unfortunately, " + profileData.lastName + " performance falls within the Poor Performance range with an average rating of " + avg + "%. This score suggests significant challenges in various aspects of the role. Frequent errors, a lack of attention to detail, and poor time management are apparent in Alex's work. Communication issues may also be impacting effectiveness. Immediate intervention is necessary to address these fundamental challenges and guide Alex towards improvement. Consider implementing targeted training and support to help Alex meet the basic expectations of the role."
                                    } else if (avg <= 40){
                                        var string = profileData.lastName + "'s performance is in the Below Average range with an average rating of " + avg + "%, indicating some competency but lacking consistency. There are difficulties with certain tasks, requiring additional supervision and guidance. Improvement is needed in areas such as problem-solving and overall task performance. Providing ongoing support and targeted training may be beneficial to help "+ profileData.lastName +" address these challenges."
                                    }else if (avg <= 60){
                                        var string = profileData.lastName + " performance falls within the Average range with an average rating of " + avg + "%, meaning they are meeting basic expectations. Work is generally adequate, with occasional errors."+ profileData.lastName +" follows instructions, but there is room for improvement in terms of consistency and possibly taking on more responsibilities. Communication skills are satisfactory but may benefit from refinement in certain areas."
                                    } else if (avg <= 80){
                                        var string = profile.lastName + "'s performance is Above Average with an average rating of " + avg + "%, consistently exceeding expectations in various tasks. They demonstrate good technical skills, take initiative, and may go beyond assigned duties. Time management is effective, and deadlines are consistently met. Communication skills are strong, contributing to effective collaboration."
                                    } else if (avg <= 100){
                                        var string = "Congratulations to "+ profileData.lastName +" for achieving an Excellent Performance rating with an average rating of " + avg + "%! This indicates exceptional performance across all aspects of the job. "+ profileData.lastName +" consistently exceeds expectations, delivering high-quality work. They proactively identify and solve problems, take initiative, and excel in time management. Outstanding communication skills contribute to effective collaboration with others. "+ profileData.lastName +" is a valuable asset to the team."
                                    } else {
                                        var string = "Currently has no Record"
                                    }%>
                                    <label class="employee_count"><%= string %></label>
                                </div>
                            </div>
                        </div>
                        
                        <% } %>

                        <div class="col-xl-12 col-sm-12 col-12 mb-4">
                            <div class="row">
                                <div id="myPlot" style="width: 100%;;"></div>
                            </div>
                        </div>
                        
                        <div class="col-xl-12 col-sm-12 col-12 mb-4">
                            <div class="card">
                                <div class="table-responsive">
                                    <table class="table  custom-table no-footer">
                                        <thead class="table-heading">
                                            <tr>
                                                <th>Company Name</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Ratings</th>
                                                <th>Remark</th>
                                                <% if(userData.role != "HR Assistant") { %><th style="color: red;">Edit History</th><% } %>
                                            </tr>
                                        </thead>
                                        <tbody>
                                             
                                            <% for(let i = 0; i < profileData.companyName.length; i++ ) { %>
                                            <tr>
                                                <% companyNameView.forEach((dataInfo) => {
                                                    
                                                    if (profileData.companyName[i] == dataInfo.id){
                                                        %><td><label id="companyNAME"><%= dataInfo.companyName %></label></td><%
                                                        
                                                    }
                                                }) %>
                                                
                                                
                                                <td><label><%= profileData.companyStartDate[i] %></label></td>
                                                <td><label><%= profileData.companyEndDate[i] %></label></td>
                                                <td><label><%= profileData.companyRatings[i] %>%</label></td>
                                                <td>
                                                    <label>
                                                        <% if(profileData.companyRatings[i] <= 20) {%>
                                                            Poor Performance
                                                        <% } else if(profileData.companyRatings[i] <= 40) {%>
                                                            Below Average
                                                        <% } else if(profileData.companyRatings[i] <= 60) {%>
                                                            Average
                                                        <% } else if(profileData.companyRatings[i] <= 80) {%>
                                                            Above Average
                                                        <% } else if(profileData.companyRatings[i] <= 100) {%>
                                                            Excellent Performance
                                                        <% } %>

                                                    </label>
                                                </td>
                                                <% if(userData.role != "HR Assistant") { %><td><a href="/update-employment-history/<%= profileData.id %>/<%= i %>" class="edit-link"><i data-feather="edit"></i></a></td><% } %>
                                            </tr>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- === UnCHARTed Area === -->

                <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

                <script> 
                  
                    var profileDataCN = "<%= profileData.companyName%>";
                    var profileDataRM = "<%= profileData.companyRatings%>";
                    var companyId = "<%= companyJustAnotherId%>";
                    var companyList = "<%= companyJustAnotherName%>";
                    var companyNAMEE = profileDataCN.split(",")
                    var companyRATINGSS = profileDataRM.split(",")
                    var companyIDD = companyId.split(",")
                    var compantLISTT = companyList.split(",")
                    var companyFinalList = []

                    for (let index = 0; index < companyNAMEE.length; index++) {
                        for (let indexA = 0; indexA < companyIDD.length; indexA++) {
                            if(companyNAMEE[index] == companyIDD[indexA]){
                                companyFinalList.push(compantLISTT[indexA])
                            }         
                        }  
                    }

                    const xArray = companyFinalList;
                    const yArray = companyRATINGSS;
                    
                    var mixedArray = [];

                    for (let index = 0; index < xArray.length; index++) {
                        mixedArray.push(index+1 +": " + xArray[index])
                    }
                    
                    // Define Data
                    const data = [{
                      x: mixedArray,
                      y: yArray,
                      mode:"lines",
                      line: {shape: "spline"},
                    }];
                    
                    // Define Layout
                    const layout = {
                      xaxis: { title: "Companies"},
                      yaxis: {range: [0, 100], title: "Rating"},  
                      title: "Employee's Rating" //title: "<%= profileData.lastName %>, <%= profileData.firstName %> <%= profileData.middleName %> Remarks"
                    };
                    
                    // Display using Plotly
                    Plotly.newPlot("myPlot", data, layout);
                    </script>

                <!-- === UnCHARTed Area === -->

                <script data-cfasync="false"
                    src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
                <script src="/assets/js/jquery-3.6.0.min.js"></script>

                <script src="/assets/js/popper.min.js"></script>
                <script src="/assets/js/bootstrap.min.js"></script>

                <script src="/assets/js/feather.min.js"></script>

                <script src="/assets/plugins/select2/js/select2.min.js"></script>

                <script src="/assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>

                <script src="/assets/js/script.js"></script>
    </body>

</html>